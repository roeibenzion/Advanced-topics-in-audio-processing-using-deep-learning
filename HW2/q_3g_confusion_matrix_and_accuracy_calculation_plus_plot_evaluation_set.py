from sklearn.metrics import confusion_matrix, accuracy_score
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns; sns.set() 

distance_matrix = np.array([
    [13.62346778, 16.89418143, 35.41609681, 29.83084687, 18.00111311, 20.40413867, 37.01598324, 17.20890646, 24.85839913, 18.66325452],
    [16.7561056, 19.86203061, 42.61871171, 36.76685119, 20.63530755, 23.48636141, 42.80660341, 20.29183226, 29.33308543, 23.06124479],
    [23.69029566, 9.37813702, 6.71320171, 8.27346362, 15.36022248, 10.99999176, 7.86896539, 20.48188058, 6.18957721, 15.57616784],
    [19.55055419, 8.47907207, 9.16060433, 8.69342914, 14.05982681, 9.80151485, 10.95174268, 18.51747445, 6.01666205, 17.29282521],
    [29.51557568, 41.85607386, 72.73683998, 65.62862646, 32.89201234, 41.88188262, 74.49678415, 34.00967016, 54.58382649, 36.5738621],
    [24.18196759, 26.01402563, 48.58789851, 43.7113757, 22.68930043, 27.56525424, 49.81510778, 21.46512698, 34.50962545, 27.23265491],
    [28.07276907, 24.59563322, 23.30353003, 22.87718505, 26.32790596, 23.84941011, 20.05474931, 23.7513149, 21.22384771, 27.16263428],
    [18.61248207, 20.37854879, 36.03398166, 32.06982496, 17.41870986, 21.1357002, 34.75972656, 17.25126723, 25.78950597, 23.13371213],
    [14.67239735, 8.19400296, 11.60834419, 9.74347378, 8.72417786, 5.02798082, 12.47076938, 15.65665853, 6.79352253, 14.88510377],
    [10.93611462, 10.20734628, 27.55572469, 22.1577062, 13.34768769, 13.97331871, 19.86065434, 12.33743824, 13.97253203, 11.07078631],
    [36.26980637, 47.09367908, 77.03389423, 68.94386723, 42.90039466, 50.7036583, 65.47101427, 41.98449554, 57.05208148, 37.00406012],
    [23.55049319, 24.03897633, 37.14892921, 33.40398773, 20.31270736, 23.32956373, 42.299716, 24.41208251, 31.214885, 28.55660092],
    [15.54535493, 16.32109055, 29.89161731, 22.98917675, 10.05904849, 15.19568633, 34.83119794, 15.79808568, 19.99932496, 18.59837244],
    [44.61119122, 58.89336446, 91.99980077, 83.95628989, 52.02854453, 58.87923825, 77.39130525, 49.64720354, 65.53146088, 48.715016],
    [18.10056217, 14.85502971, 25.11013804, 20.00475784, 8.90241561, 11.97572166, 31.04459851, 16.41070677, 16.13552191, 20.68827623],
    [26.84201653, 27.36324281, 42.09032682, 37.95315403, 20.11363672, 23.3532653, 44.28889245, 24.88911234, 31.94736455, 28.34287998],
    [18.94290186, 14.65719238, 19.07855323, 15.29584152, 13.30709192, 13.49776146, 20.13638608, 20.50186006, 12.3088372, 19.87831744],
    [30.22008706, 35.80675072, 60.8289085, 54.89628055, 28.13316525, 37.38830879, 52.95776194, 28.62718328, 42.79292213, 28.96000752],
    [35.37636147, 49.37227108, 86.01857858, 77.72275763, 37.61559686, 50.64929069, 78.10055089, 39.37962505, 59.52215768, 43.74749043],
    [25.39937217, 25.35129173, 44.71593457, 40.47679948, 22.23423438, 27.3039471, 42.13605379, 26.92837949, 32.6661199, 23.13797041],
    [313.35929398, 415.06672612, 563.9896545, 534.50098864, 376.44151705, 424.06639952, 516.83464054, 353.80527221, 463.01779083, 336.52473486],
    [155.96957773, 199.56432823, 257.99506997, 249.41388313, 169.10839093, 186.00742086, 247.64605102, 159.56976388, 217.53842823, 162.61810318],
    [284.57500578, 371.12450079, 485.76087679, 454.55193797, 329.78204297, 371.76804719, 500.31605661, 310.33597495, 420.89125543, 315.83342916],
    [241.01755985, 321.33776186, 465.53614406, 433.75965578, 277.52157423, 323.01782156, 453.24814978, 262.97717731, 379.14737797, 281.79867189],
    [92.12329464, 125.7919115, 160.30566499, 149.74739682, 105.45162607, 118.02280959, 151.78425244, 96.39152319, 126.10711366, 104.75257238],
    [130.11632046, 163.2810365, 225.66400256, 214.28723385, 145.63287597, 164.00320524, 207.91248878, 140.18506385, 184.50926774, 131.08492127],
    [31.94765597, 28.67947917, 25.38051395, 28.53269029, 31.04646905, 27.57644343, 24.26030918, 29.72752994, 28.96808867, 33.95715636],
    [172.93883485, 237.04752804, 331.26817738, 310.67106687, 219.54276256, 245.95802252, 295.48317593, 197.27379027, 275.72216831, 188.47439026],
    [240.87855314, 318.03024524, 435.92119393, 415.96863506, 302.988066, 332.84760999, 391.1149059, 272.90484024, 360.60827591, 249.38740744],
    [142.97367111, 192.18042579, 288.68870619, 270.60832445, 176.76682701, 200.09777422, 258.66826435, 160.55324818, 231.05251306, 150.30950677],
    [13.42112384, 12.14055875, 26.96157532, 23.46826148, 12.66437595, 12.72755619, 16.9133766, 14.39669385, 13.2147655, 12.60936521],
    [15.67946822, 9.25992771, 14.90124853, 12.27808988, 7.08356893, 7.78199052, 15.45964923, 14.51254782, 7.94631727, 15.37661154],
    [27.42338717, 10.51963969, 4.53093628, 5.8832503, 14.47354949, 9.41164476, 6.44343814, 25.19143373, 3.85984373, 25.70067996],
    [22.9461811, 11.02297716, 10.12792153, 7.8882347, 11.08817099, 10.24149749, 18.5508261, 19.16435156, 9.69208572, 27.76606852],
    [15.45089001, 8.75544269, 13.65756803, 11.47813803, 6.18250336, 6.78573175, 17.04250424, 11.51883411, 7.95732973, 16.65569568],
    [21.9209193, 19.62320715, 28.44926277, 26.72072356, 15.9404926, 15.76790105, 30.48470539, 17.43103464, 19.32011535, 24.81133984],
    [37.82419894, 15.802609, 4.05067011, 8.67251785, 21.02205394, 12.51121819, 5.2098632, 33.81254297, 5.61660829, 36.4407872],
    [19.56146586, 17.62568631, 23.86135748, 23.41705628, 11.46893901, 12.55404648, 24.00112435, 16.20947449, 14.64839594, 18.11413877],
    [21.70803201, 9.36699148, 7.99665649, 5.4214476, 10.0579885, 7.61886449, 9.9732983, 19.61300786, 4.15892109, 18.64149369],
    [15.43617216, 9.44946769, 15.20086201, 13.31723143, 10.19750818, 7.93693999, 10.05688, 16.15441635, 6.04832619, 11.82674668]
])


# Since there are 4 speakers and each has recordings for digits 0-9, we construct true labels accordingly
num_speakers = 4
num_digits = 10
true_labels = np.tile(np.arange(num_digits), num_speakers)
labels = np.unique(true_labels)
predicted_labels = np.argmin(distance_matrix, axis=1)

# Construct the confusion matrix
conf_matrix = confusion_matrix(true_labels, predicted_labels)
accuracy = accuracy_score(true_labels, predicted_labels)

with open('confusion_matrix_accuracy_results_evaluation_set.txt', 'w') as file:
    file.write("Distance Matrix:\n")
    np.savetxt(file, distance_matrix, fmt='%f', delimiter=', ')
    
    file.write("\nConfusion Matrix:\n")
    np.savetxt(file, conf_matrix, fmt='%d', delimiter=', ')
    
    file.write("\nAccuracy:\n")
    file.write("{:.4f}".format(accuracy))
    
print("Confusion Matrix:")
print(conf_matrix)

print("\nAccuracy:", accuracy)

plt.figure(figsize=(10, 7))
sns.heatmap(conf_matrix, annot=True, fmt='d', cmap='Blues', xticklabels=labels, yticklabels=labels)
plt.title('Confusion Matrix')
plt.xlabel('Predicted Labels')
plt.ylabel('True Labels')
plt.savefig('confusion_matrix.png', bbox_inches='tight', dpi=300)
plt.show()

